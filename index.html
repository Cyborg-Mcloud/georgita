<!DOCTYPE html>
<html>
  <head>
 <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
	<meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline' 'unsafe-eval'">
  	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Georgita</title>
<script type="text/javascript" charset="utf-8" src="cordova.js"></script>


 <link rel="stylesheet" href="leaf/leaflet.css" crossorigin=""/>
<script src="leaf/leaflet.js" crossorigin=""></script>
<script src="leaflet-tilelayer-cordova.js"></script>
  </head>
  <style>
	
	a {text-decoration:none; color:white;}
  </style>
  <body style='padding:0; border:0; margin:0; '>
  


<div id="mapid" style='border:1px solid red; width:300px; height:300px;'></div>

<div id="status_block"></div>

<img id='myimg'>


<script>
var myfolder="";
function checkIfFileExists()
	{
	window.requestFileSystem(LocalFileSystem.PERSISTENT, 0, function(fileSystem){
		fileSystem.root.getDirectory("tiles", {create: true, exclusive: false}, fileExists, fileDoesNotExist);
		console.log(fileSystem);
		

		} , getFSFail); 

	}


function getFSFail(evt)
	{
    console.log("shit error");
	    console.log(evt);
	}

function fileExists(fileEntry)
	{
		console.log(fileEntry);
		if (myfolder=="")
			{
			myfolder=fileEntry.toURL();
			}

		console.log(myfolder);
//		console.log("aris!");
//	dataex=1;
	}
function fileDoesNotExist()
	{
//		console.log("ar arsebobda");
//    dataex=0;
	}

var BASE;
var status_block=document.getElementById("status_block");
 function onDeviceReady() 
 {

checkIfFileExists();

var mymap = L.map('mapid').setView([41.8381203,44.7309707], 14);

BASE = L.tileLayerCordova('https://mts1.google.com/vt/hl=en&s=ge&lyrs=m&x={x}&y={y}&z={z}', {
        // these options are perfectly ordinary L.TileLayer options
        maxZoom: 18,
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright/">OpenStreetMap contributors</a>',
        // these are specific to L.TileLayer.Cordova and mostly specify where to store the tiles on disk
        folder: 'tiles',
        name:   'tiles',
        debug:   true
    }).addTo(mymap);

    // calculate a tile pyramid starting at a lat/lon and going down to a stated range of zoom levels
  
	setTimeout("downtiles()",1000);
	BASe.goOffline();
}
 document.addEventListener("deviceready", onDeviceReady, false);


function downtiles()
{
	  var tile_list = BASE.calculateXYZListFromPyramid(41.709455, 44.7551886, 14, 15);
 BASE.downloadXYZList(
        // 1st param: a list of XYZ objects indicating tiles to download
        tile_list,
        // 2nd param: overwrite existing tiles on disk?
        // if no then a tile already on disk will be kept, which can be a big time saver
        true,
        // 3rd param: progress callback
        // receives the number of tiles downloaded and the number of tiles total
        // caller can calculate a percentage, update progress bar, etc.
        // Cancel: if the progress callback returns false (not null or undefined, but false)
        // then BASE.downloadXYZList() interprets that as a cancel order and will cease downloading tiles
        // great for a cancel button!
        function (done,total) {
            var percent = Math.round(100 * done / total);
            status_block.innerHTML = done  + " / " + total + " = " + percent + "%";
        },
        // 4th param: complete callback
        // no parameters are given, but we know we're done!
        function () {
            // for this demo, on success we use another L.TileLayer.Cordova feature and show the disk usage!
            BASE.getDiskUsage(function (filecount,bytes) {
                var kilobytes = Math.round( bytes / 1024 );
                status_block.innerHTML = "Done" + "<br/>" + filecount + " files" + "<br/>" + kilobytes + " kB";
            });
        },
        // 5th param: error callback
        // parameter is the error message string
        function (error) {
            alert("Failed\nError code: " + error.code);
        }
    );
	}
</script>

</body>



</html>
